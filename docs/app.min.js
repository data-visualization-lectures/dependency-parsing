const inputText=document.getElementById("inputText"),analyzeBtn=document.getElementById("analyzeBtn"),sampleBtn=document.getElementById("sampleBtn"),clearBtn=document.getElementById("clearBtn"),exportSvgBtn=document.getElementById("exportSvgBtn"),exportPngBtn=document.getElementById("exportPngBtn"),exportDataBtn=document.getElementById("exportDataBtn"),exportGexfBtn=document.getElementById("exportGexfBtn"),exportButtons=document.getElementById("exportButtons"),chartSelector=document.getElementById("chartSelector"),chartType=document.getElementById("chartType"),loadingOverlay=document.getElementById("loadingOverlay"),infoPanel=document.getElementById("infoPanel"),sampleSentences=["ä»Šæ—¥ã‚‚ã¾ãŸã¾ãŸå‡ºå ´æƒ…å ±ã§ã™ã€‚ãã‚Œã‚‚ãã®ã¯ãšã‚®ãƒªã‚®ãƒªã«ãªã‚Šã¾ã—ãŸã‹ã‚‰ã€æ€¥é½å¤±ç¤¼ã—ã¾ã™ã€‚æœ¬æ—¥æ—¥æœ¬ãƒ†ãƒ¬ãƒ“ã•ã‚“ã«ã¦ã€Œãªã‚“ã§ãã‚“ãªã“ã¨è¨€ã£ãŸã®ï¼ŸTVã€ã«å‡ºå ´ã—ã¦ã„ã¾ã™ğŸ’ğŸ¼ğŸ¶ ã“ã¡ã‚‰ã¯ã€éå»ã‚’ã‚ã–ã‚ã–é¡ã‚Šãªãœäººã¯ã‚ã‚“ãªã“ã¨ã‚’è¨€ã£ãŸã®ã‹ã‚’èãã¨ã„ã†ãã‚Œãªã‚Šã«é¡Œåãã®ã¾ã¾ãªç•ªçµ„ã§ã™ã€‚ç§ã¯å…¨ä½“çš„ã«ç«¯ã£ã“ã®ã»ã†ã§ã€MCè»å›£ã«èã‹ã‚ŒãŸã‚‰ç­”ãˆã‚‹ã€èã‹ã‚ŒãŸã‚‰ç­”ãˆã‚‹ã®ç¹°ã‚Šè¿”ã—ã§ã€ã“ã‚“ãªæ„Ÿã˜ã«ç›®ã®ã‚„ã‚‰ã‚Œã‚‹è›å…‰è‰²ãŸã¶ã‚‰ã‹ã—ã¦åº§ã£ã¦ã„ã¾ã™ã€‚æ˜¯éã€èƒ¸ã®ã‚¶ãƒ¯ã‚¶ãƒ¯æ„ŸãŒå¥½ããªæ–¹ã¯è¦‹ã¦ã„ãŸã‚‰æ¥½ã—ã„ã¨æ€ã†ã®ã§è¦‹ã¦ãã ã•ã„ã€‚å¾…ã£ã¦ã„ã¾ã™ã€‚","å¤ªéƒã¯èŠ±å­ã«ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã‚’ã‚ã’ãŸã€‚","ç§ã¯æ˜¨æ—¥ã€å›³æ›¸é¤¨ã§é¢ç™½ã„æœ¬ã‚’èª­ã‚“ã ã€‚","å½¼å¥³ã¯ç¾ã—ã„èŠ±ã‚’åº­ã«æ¤ãˆãŸã€‚","å…ˆç”ŸãŒç”Ÿå¾’ã«å®¿é¡Œã‚’å‡ºã—ãŸã€‚","çŒ«ãŒçª“ã®å¤–ã‚’é™ã‹ã«è¦‹ã¦ã„ã‚‹ã€‚","å‹é”ã¨ä¸€ç·’ã«æ˜ ç”»ã‚’è¦‹ã«è¡Œã£ãŸã€‚"];let currentParseResult=null;async function initializeApp(){showLoading(!0);try{await parser.initialize(),console.log("Parser initialized successfully"),setupEventListeners()}catch(e){console.error("Failed to initialize parser:",e),alert("ãƒ‘ãƒ¼ã‚µãƒ¼ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚")}finally{showLoading(!1)}}function setupEventListeners(){analyzeBtn.addEventListener("click",handleAnalyze),sampleBtn.addEventListener("click",handleSample),clearBtn.addEventListener("click",handleClear),exportSvgBtn.addEventListener("click",()=>visualizer.exportSVG()),exportPngBtn.addEventListener("click",()=>visualizer.exportPNG()),exportDataBtn.addEventListener("click",handleDownloadData),exportGexfBtn.addEventListener("click",handleDownloadGexf),inputText.addEventListener("keydown",e=>{"Enter"===e.key&&(e.ctrlKey||e.metaKey)&&handleAnalyze()}),chartType.addEventListener("change",handleChartTypeChange)}async function handleAnalyze(){const e=inputText.value.trim();if(e){showLoading(!0),infoPanel.style.display="none";try{await new Promise(e=>setTimeout(e,100)),currentParseResult=parser.parse(e),console.log("Parse result:",currentParseResult),visualizer.visualize(currentParseResult,chartType.value),exportButtons.style.display="flex",chartSelector.style.display="flex"}catch(e){console.error("Analysis failed:",e),alert("è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: "+e.message)}finally{showLoading(!1)}}else alert("ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚")}function handleSample(){const e=sampleSentences[Math.floor(Math.random()*sampleSentences.length)];inputText.value=e,inputText.focus()}function handleClear(){inputText.value="",inputText.focus()}function handleChartTypeChange(){currentParseResult&&visualizer.visualize(currentParseResult,chartType.value)}function handleDownloadData(){if(!currentParseResult)return void alert("ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚");const e=JSON.stringify(currentParseResult,null,2),t=new Blob([e],{type:"application/json;charset=utf-8"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download="dependency-parsing-data.json",a.click(),URL.revokeObjectURL(n)}function handleDownloadGexf(){if(!currentParseResult)return void alert("ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚");const{bunsetsu:e,dependencies:t}=currentParseResult;let n='<?xml version="1.0" encoding="UTF-8"?>\n';n+='<gexf xmlns="http://www.gexf.net/1.2draft" version="1.2">\n',n+='  <graph mode="static" defaultedgetype="directed">\n',n+="    <nodes>\n",e.forEach((e,t)=>{const a=escapeXml(e.surface);n+=`      <node id="${t}" label="${a}"/>\n`}),n+="    </nodes>\n",n+="    <edges>\n",t.forEach((e,t)=>{const a=escapeXml(e.label);n+=`      <edge id="${t}" source="${e.from}" target="${e.to}" label="${a}"/>\n`}),n+="    </edges>\n",n+="  </graph>\n",n+="</gexf>";const a=new Blob([n],{type:"application/gexf+xml;charset=utf-8"}),l=URL.createObjectURL(a),r=document.createElement("a");r.href=l,r.download="dependency-parsing-data.gexf",r.click(),URL.revokeObjectURL(l)}function escapeXml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function showLoading(e){e?loadingOverlay.classList.add("active"):loadingOverlay.classList.remove("active")}function showError(e){document.getElementById("visualizationContainer").innerHTML=`\n        <div class="placeholder">\n            <div class="placeholder-icon">âŒ</div>\n            <p class="placeholder-text">ã‚¨ãƒ©ãƒ¼</p>\n            <p class="placeholder-subtext">${e}</p>\n        </div>\n    `}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initializeApp):initializeApp();