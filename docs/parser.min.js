class DependencyParser{constructor(){this.tokenizer=null,this.initialized=!1}async initialize(){if(!this.initialized)return console.log("üì• Starting kuromoji initialization..."),console.log("üìç Dictionary path: ./dict"),new Promise((e,t)=>{try{const n=kuromoji.builder({dicPath:"./dict"});console.log("‚è≥ Building kuromoji..."),n.build((n,i)=>{if(n)return console.error("‚ùå Kuromoji build error:",n),void t(n);this.tokenizer=i,this.initialized=!0,console.log("‚úÖ Kuromoji tokenizer initialized successfully"),e()})}catch(e){console.error("‚ùå Kuromoji initialization error:",e),t(e)}});console.log("‚úÖ Parser already initialized")}parse(e){if(!this.initialized||!this.tokenizer)throw new Error("Parser not initialized");const t=this.tokenizer.tokenize(e),n=this.groupIntoBunsetsu(t);return{bunsetsu:n,dependencies:this.estimateDependencies(n),tokens:t}}groupIntoBunsetsu(e){const t=[];let n=[];for(let i=0;i<e.length;i++){const o=e[i];n.push(o);const r=i===e.length-1,s="Ë®òÂè∑"===o.pos;let l=r||s;if(!l&&i<e.length-1){const t=e[i+1],n=this.isFunctionWord(o),r=this.isContentWord(t);l=n&&r}l&&n.length>0&&(t.push({id:t.length,tokens:n,surface:n.map(e=>e.surface_form).join(""),head:this.findHead(n)}),n=[])}return t}isContentWord(e){return["ÂêçË©û","ÂãïË©û","ÂΩ¢ÂÆπË©û","ÂâØË©û","ÈÄ£‰ΩìË©û","ÊÑüÂãïË©û"].includes(e.pos)}isFunctionWord(e){return["Âä©Ë©û","Âä©ÂãïË©û","Êé•Á∂öË©û"].includes(e.pos)}findHead(e){const t={"ÂãïË©û":3,"ÂΩ¢ÂÆπË©û":2,"ÂêçË©û":1};let n=e[0],i=t[n.pos]||0;for(const o of e){const e=t[o.pos]||0;e>i&&(n=o,i=e)}return n}estimateDependencies(e){const t=[];for(let n=0;n<e.length-1;n++){const i=e[n];let o=this.findDependencyTarget(i,n,e);t.push({from:n,to:o,label:this.getDependencyLabel(i,e[o])})}return t}findDependencyTarget(e,t,n){const i=e.tokens[e.tokens.length-1],o=e.head;if(this.isClauseConnector(i))return this.findNextPredicate(t,n);if("Âä©Ë©û"===i.pos){const e=i.surface_form;if(["„ÅØ","„Åå","„Çí","„Å´","„Å∏","„Åß","„Åã„Çâ","„Åæ„Åß","„Çà„Çä","„Å®"].includes(e))return this.findNextVerb(t,n);if("„ÅÆ"===e)return this.findNextNoun(t,n)}if("ÂâØË©û"===o.pos)return this.findNextPredicate(t,n);if("ÈÄ£‰ΩìË©û"===o.pos)return this.findNextNoun(t,n);if("ÂêçË©û"===o.pos&&"Âä©Ë©û"!==i.pos)for(let e=t+1;e<n.length;e++){const t=n[e];if("ÂêçË©û"===t.head.pos||"ÂãïË©û"===t.head.pos)return e}if("ÂãïË©û"===o.pos){if("Ëá™Á´ã"!==o.pos_detail_1||i.surface_form.match(/[„Å¶„Åß„Åü„Çä„Å™„Åå„Çâ]/))return this.findNextPredicate(t,n)}return t+1}isClauseConnector(e){return"Âä©Ë©û"===e.pos?["„Å¶","„Åß","„Å∞","„Å®","„Å¶„ÇÇ","„Åß„ÇÇ","„Åã„Çâ","„ÅÆ„Åß","„ÅÆ„Å´","„Åë„Å©","„Åå"].includes(e.surface_form):"Âä©ÂãïË©û"===e.pos&&["„Åü","„Å†","„Åß„Åô","„Åæ„Åô"].includes(e.basic_form)}findNextVerb(e,t){for(let n=e+1;n<t.length;n++)if("ÂãïË©û"===t[n].head.pos)return n;return t.length-1}findNextNoun(e,t){for(let n=e+1;n<t.length;n++)if("ÂêçË©û"===t[n].head.pos)return n;return e+1}findNextPredicate(e,t){for(let n=e+1;n<t.length;n++){const e=t[n].head;if("ÂãïË©û"===e.pos||"ÂΩ¢ÂÆπË©û"===e.pos)return n}return t.length-1}getDependencyLabel(e,t){const n=e.tokens[e.tokens.length-1];return"Âä©Ë©û"===n.pos?n.surface_form:""}}const parser=new DependencyParser;